<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game - TradeHax</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/enhancements.css">
    <link rel="stylesheet" href="../assets/extended-theme.css">
    <style>
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            font-family: 'Courier New', monospace;
        }
        .game-container {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        .score-display {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        .control-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
        }
        .retro-button {
            background: linear-gradient(135deg, #333 0%, #000 100%);
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px #00ff00;
            transition: all 0.3s ease;
        }
        .retro-button:hover {
            background: linear-gradient(135deg, #00ff00 0%, #333 100%);
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }
        canvas {
            border: 3px solid #00ff00;
            background: #000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        .pixel-text {
            font-family: 'Courier New', monospace;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body class="text-green-400">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 pixel-text">üêç RETRO SNAKE</h1>
            <p class="text-xl text-gray-300 mb-4">Classic arcade action with modern graphics ‚Ä¢ Earn Clover Coins</p>
            <a href="../" class="inline-block bg-gray-800 hover:bg-gray-700 text-white px-6 py-2 rounded border border-green-500 transition-colors">‚Üê Back to Home</a>
        </div>

        <!-- Web3 Wallet & Rewards -->
        <div id="wallet-container" class="mb-8"></div>

        <div class="max-w-4xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Game Area -->
                <div class="lg:col-span-2">
                    <div class="game-container rounded-lg p-6">
                        <div class="text-center mb-4">
                            <h2 class="text-2xl font-bold pixel-text">GAME FIELD</h2>
                        </div>
                        <div class="flex justify-center">
                            <canvas id="snakeCanvas" width="400" height="400"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="control-panel rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4 pixel-text">STATUS</h3>

                    <div class="space-y-4 mb-6">
                        <div class="score-display p-3 rounded">
                            <div class="text-sm opacity-75">SCORE</div>
                            <div id="score" class="text-2xl font-bold">00000</div>
                        </div>

                        <div class="score-display p-3 rounded">
                            <div class="text-sm opacity-75">HIGH SCORE</div>
                            <div id="highScore" class="text-2xl font-bold">00000</div>
                        </div>

                        <div class="score-display p-3 rounded">
                            <div class="text-sm opacity-75">LEVEL</div>
                            <div id="level" class="text-2xl font-bold">01</div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <button id="startBtn" onclick="startSnake()" class="retro-button w-full py-3 px-4 rounded font-bold">
                            START GAME
                        </button>
                        <button onclick="pauseGame()" class="retro-button w-full py-3 px-4 rounded font-bold">
                            PAUSE/RESUME
                        </button>
                        <button onclick="resetGame()" class="retro-button w-full py-3 px-4 rounded font-bold">
                            RESET
                        </button>
                    </div>

                    <div class="mt-6 text-sm text-gray-400">
                        <h4 class="font-bold mb-2 pixel-text">CONTROLS:</h4>
                        <div class="space-y-1">
                            <div>‚Üë‚Üì‚Üê‚Üí Arrow Keys</div>
                            <div>WASD Keys</div>
                            <div>Space: Pause</div>
                        </div>
                    </div>

                    <div class="mt-6 text-xs text-gray-400">
                        <h4 class="font-bold mb-2 pixel-text text-green-400">REWARDS:</h4>
                        <div class="space-y-1">
                            <div>‚Ä¢ 10 points: +1 coin</div>
                            <div>‚Ä¢ Level up: +5 coins</div>
                            <div>‚Ä¢ High score: +25 coins</div>
                            <div>‚Ä¢ Level 10: +50 coins</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="web3-rewards.js"></script>

    <script>
        // Initialize Web3 Rewards
        const rewardsSystem = new Web3RewardsSystem('snake');
        rewardsSystem.initWalletUI('wallet-container');

        // Enhanced Snake Game with better graphics and controls
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('snakeCanvas');
                if (!this.canvas) {
                    console.error('Snake canvas not found!');
                    return;
                }
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = this.canvas.width / this.gridSize;

                this.snake = [{x: 10, y: 10}];
                this.food = {};
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.highScore = localStorage.getItem('snakeHighScore') || 0;
                this.level = 1;
                this.gameRunning = false;
                this.paused = false;
                this.gameLoop = null;

                this.updateDisplay();
                this.generateFood();
                this.setupControls();
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score.toString().padStart(5, '0');
                document.getElementById('highScore').textContent = this.highScore.toString().padStart(5, '0');
                document.getElementById('level').textContent = this.level.toString().padStart(2, '0');
            }

            generateFood() {
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
            }

            draw() {
                // Clear canvas with retro effect
                this.ctx.fillStyle = '#000011';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw grid
                this.ctx.strokeStyle = 'rgba(0, 255, 0, 0.1)';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= this.tileCount; i++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(i * this.gridSize, 0);
                    this.ctx.lineTo(i * this.gridSize, this.canvas.height);
                    this.ctx.stroke();

                    this.ctx.beginPath();
                    this.ctx.moveTo(0, i * this.gridSize);
                    this.ctx.lineTo(this.canvas.width, i * this.gridSize);
                    this.ctx.stroke();
                }

                // Draw snake with glow effect
                this.snake.forEach((segment, index) => {
                    if (index === 0) {
                        // Head - brighter green
                        this.ctx.shadowColor = '#00ff00';
                        this.ctx.shadowBlur = 10;
                        this.ctx.fillStyle = '#00ff00';
                    } else {
                        // Body - darker green
                        this.ctx.shadowBlur = 5;
                        this.ctx.fillStyle = '#008800';
                    }

                    this.ctx.fillRect(
                        segment.x * this.gridSize + 2,
                        segment.y * this.gridSize + 2,
                        this.gridSize - 4,
                        this.gridSize - 4
                    );
                });

                // Draw food with pulsing effect
                const time = Date.now() * 0.005;
                const pulse = Math.sin(time) * 0.3 + 0.7;

                this.ctx.shadowColor = '#ff0000';
                this.ctx.shadowBlur = 15;
                this.ctx.fillStyle = `rgba(255, 0, 0, ${pulse})`;
                this.ctx.fillRect(
                    this.food.x * this.gridSize + 1,
                    this.food.y * this.gridSize + 1,
                    this.gridSize - 2,
                    this.gridSize - 2
                );

                this.ctx.shadowBlur = 0;
            }

            move() {
                if (!this.gameRunning || this.paused) return;

                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};

                // Wall collision
                if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                    this.gameOver();
                    return;
                }

                // Self collision
                for (let segment of this.snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        this.gameOver();
                        return;
                    }
                }

                this.snake.unshift(head);

                // Food collision
                if (head.x === this.food.x && head.y === this.food.y) {
                    const previousScore = this.score;
                    const previousLevel = this.level;
                    this.score += 10 * this.level;
                    this.generateFood();

                    // Award coins for score milestones
                    const scoreDiff = this.score - previousScore;
                    if (scoreDiff >= 10 && Math.floor(this.score / 10) > Math.floor(previousScore / 10)) {
                        rewardsSystem.awardCoins(1, 'Snake: 10 points scored');
                    }

                    // Level up every 50 points
                    if (this.score > 0 && this.score % 50 === 0) {
                        this.level++;
                        rewardsSystem.awardForLevelUp('snake', this.level);
                        
                        // Special bonus for reaching level 10
                        if (this.level === 10) {
                            rewardsSystem.awardCoins(50, 'Snake: Reached Level 10!');
                        }
                    }

                    if (this.score > this.highScore) {
                        const wasNewHighScore = true;
                        this.highScore = this.score;
                        localStorage.setItem('snakeHighScore', this.highScore);
                        rewardsSystem.awardForHighScore('snake');
                    }
                } else {
                    this.snake.pop();
                }

                this.updateDisplay();
            }

            gameOver() {
                this.gameRunning = false;
                clearInterval(this.gameLoop);
                alert(`Game Over!\nScore: ${this.score}\nLevel: ${this.level}\nHigh Score: ${this.highScore}`);
                this.reset();
            }

            start() {
                if (this.gameRunning) return;

                this.gameRunning = true;
                this.paused = false;
                rewardsSystem.resetSession();
                document.getElementById('startBtn').textContent = 'RESTART';

                this.gameLoop = setInterval(() => {
                    this.move();
                    this.draw();
                }, Math.max(50, 150 - (this.level * 10))); // Speed increases with level
            }

            pause() {
                this.paused = !this.paused;
            }

            reset() {
                this.snake = [{x: 10, y: 10}];
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.level = 1;
                this.gameRunning = false;
                this.paused = false;
                clearInterval(this.gameLoop);
                document.getElementById('startBtn').textContent = 'START GAME';
                this.generateFood();
                this.draw();
                this.updateDisplay();
            }

            setupControls() {
                document.addEventListener('keydown', (e) => {
                    if (!this.gameRunning) return;

                    const key = e.key.toLowerCase();
                    const goingUp = this.dy === -1;
                    const goingDown = this.dy === 1;
                    const goingRight = this.dx === 1;
                    const goingLeft = this.dx === -1;

                    if ((key === 'arrowup' || key === 'w') && !goingDown) {
                        e.preventDefault();
                        this.dx = 0;
                        this.dy = -1;
                    } else if ((key === 'arrowdown' || key === 's') && !goingUp) {
                        e.preventDefault();
                        this.dx = 0;
                        this.dy = 1;
                    } else if ((key === 'arrowleft' || key === 'a') && !goingRight) {
                        e.preventDefault();
                        this.dx = -1;
                        this.dy = 0;
                    } else if ((key === 'arrowright' || key === 'd') && !goingLeft) {
                        e.preventDefault();
                        this.dx = 1;
                        this.dy = 0;
                    } else if (key === ' ') {
                        e.preventDefault();
                        this.pause();
                    }
                });
            }
        }

        const game = new SnakeGame();
        game.draw();

        function startSnake() {
            game.start();
        }

        function pauseGame() {
            game.pause();
        }

        function resetGame() {
            game.reset();
        }
    </script>
    <script src="../theme-extensions.js"></script>
</body>
</html>
